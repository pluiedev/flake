when:
  - event: ["push", "pull_request", "manual"]
    branch: ["main"]

engine: "nixery"

# using the default values
clone:
  skip: false
  depth: 1
  submodules: false

dependencies:
  nixpkgs:
    - nix
    - cachix

environment:
  CACHE_NAME: "pluiedev"
  FLAKE_ATTR: ".#nixosConfigurations.pappardelle.config.system.build.toplevel"

steps:
  - name: "Evaluate pappardelle"
    command: "nix eval --accept-flake-config $FLAKE_ATTR"
  - name: "Build pappardelle"
    command: "USER=root cachix watch-exec $CACHE_NAME -- nix build --accept-flake-config $FLAKE_ATTR"
